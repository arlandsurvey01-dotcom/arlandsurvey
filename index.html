<script>

/* ================= GOOGLE SHEET BACKEND CONFIG ================= */

const SCRIPT_URL = "https://script.google.com/macros/s/AKfycby_RVjk1uwYEEWfce65J4Qn-khYfQsSq_-7yJ8VZxssWqIw2CqDprXnxHgXfpVu7m0b/exec";

/* ================= LOADER ================= */

window.addEventListener("load", function(){
    const loader = document.getElementById("loader");
    if(loader){
        setTimeout(()=> loader.classList.add("fade-out"), 500);
    }
});

/* ================= FORM SUBMIT ================= */

const form = document.getElementById("bookingForm");

if(form){
form.addEventListener("submit", async function(e){

    e.preventDefault();

    let name = document.getElementById("name").value.trim();
    let mobile = document.getElementById("mobile").value.trim();
    let village = document.getElementById("village").value.trim();
    let service = document.getElementById("serviceType").value;
    let date = document.getElementById("date").value;

    /* ===== VALIDATION ===== */

    if(name.length < 3){
        alert("Please enter valid name");
        return;
    }

    if(!/^[0-9]{10}$/.test(mobile)){
        alert("Enter valid 10 digit mobile number");
        return;
    }

    let today = new Date().toISOString().split("T")[0];
    if(date < today){
        alert("Booking date cannot be in the past");
        return;
    }

    const bookingData = {
        name: name,
        mobile: mobile,
        village: village,
        service: service,
        date: date
    };

    try {

        const response = await fetch(SCRIPT_URL, {
            method: "POST",
            body: JSON.stringify(bookingData),
            headers: {
                "Content-Type": "application/json"
            }
        });

        const result = await response.json();

        if(result.status === "success"){
            alert("Booking Successful!\nYour Booking ID: " + result.id);
            form.reset();
            document.getElementById("slotBar").style.width = "0%";
            document.getElementById("slotInfo").innerText = "";
        } else {
            alert("Submission Failed. Please try again.");
        }

    } catch(error){
        alert("Server error. Please try later.");
        console.error(error);
    }

});
}

/* ================= SLOT BAR VISUAL ================= */

const dateInput = document.getElementById("date");

if(dateInput){
dateInput.addEventListener("change", function(){

    const bar = document.getElementById("slotBar");
    const info = document.getElementById("slotInfo");

    if(bar) bar.style.width = "40%";
    if(info) info.innerText = 
        "Slot confirmation will be done after admin review.";
});
}

</script>
